\providecommand{\mainpath}{..} % Command to retrieve the path of the main file. It must be defined before documentclass.

\documentclass[\mainpath/main]{subfiles}
\begin{document}

\chapter{Architectural Design}
\label{architectural_design}

% Command to be executed after the starting of every chapter
\setmyfancystyle
% ----------------

In this chapter the complete architecture of myTaxiService is shown with various levels of description. In the \autoref{ArchitecturalDesign:high_level} there is a global view and the interactions between all the components are described.\\ 
The data tier is illustrated in \autoref{ArchitecturalDesign:component} with all related policies and entities. Then the other tiers are characterized using different diagrams.\\
In the \autoref{ArchitecturalDesign:deploy} the deployment of each components is illustrated (for instance the data component is sit in a different place with respect to the other component? It is replaced twice or more? And similar question will have an answer).\\
In \autoref{ArchitecturalDesign:runtime} the view level is defined. The interactions between all kinds of user and the system are described using UX diagrams and sequence diagrams that display the order in which each screen is visualized. Besides, the \glspl{mockup} of these screens are shown in \autoref{UIDesign}.
\\
A standalone paragraph, the \autoref{ArchitecturalDesign:comp_interfaces}, is dedicated to list all interfaces, both internal (between two components) and external.\\
Finally, in the \autoref{ArchitecturalDesign:design_patterns} the design patterns used to develop myTaxiService are described first in general case. After that, all the changes needed to adapt this design patterns to our system are characterized.


\section{Distinctions between various kind of Users and Clients}
\label{ArchitecturalDesign:preamble}
The "visible architecture" of myTaxiService is very varied. The term visible is referred to various user interfaces, so what the users can see when they are using the system.\\
On the other hand, we have said that myTaxiService is varied because it has two principal version (\gls{ma} and \gls{ws}) and for both of them there are a few levels of specialization, according to the kind of the user. All of them are explained in this paragraph.\\
\\
The WS version is shown into a browser, so there is no client application that can be used. Hence, all the pages are loaded into the server and then they are sent to the client browser.\\
Instead, the \gls{ma} is a client application and it has different ways to communicate with the server. All the aspects concerning these differences are explained better during the descriptions of the architecture's components that handle the clients.\\
\\
%Fare un riferimento al capitolo che mette in relazione RASD e DD per far capire il tipo di attore?
The cab company is the special user who administrates the service. Obviously, it has a command center at its headquarters where it can control both the system and the service situation. Hence its special functions are not implemented neither in the \gls{ma} nor in the \gls{ws}, but they can directly access the server using private keys and reserved terminals.\\
A customers can use both the \gls{ma} and the \gls{ws} to enjoy his functionalities. No particular cases or restriction are reserved to them.\\
When a driver logs into the service, we suppose that it is working, so his special functionalities are developed and implemented only for the \gls{ma}. In fact no driver carries a computer with an internet connection on his taxi and uses it. On the other hand, since the driver is also an user, it can use the WS, but here he has only the user functionalities due to the reason shown above.\\



\section{High level components and their interaction}
\label{ArchitecturalDesign:high_level}

The main structure of myTaxiService can be described as a Service-Oriented architecture (see \autoref{ArchitecturalDesign:design_patterns} to have a detailed description of this design pattern). In addition to this idea the Model-View-Controller paradigm is applied in order to develop a good-programmed, reusable and easy-maintainable system.
\begin{figure}[h]
	\centering
	\includegraphics[width=10cm] {main_architecture}
	\caption{High level architecture}
	\label{ArchitecturalDesign:figure1}
\end{figure}

In the figure \ref{ArchitecturalDesign:figure1} is shown the architecture. At the bottom of the figure there is the \nameref{ArchitecturalDesign:datatier} which contains only the database (a component that stores all data about the customers, the rides and the system).\\
\\
The central part of the picture contains the provider, the big component that gives the service. At this level of description we can look in the provider. This component is split into five parts. The DataBase Managment System (DMBS) manages all communications with the \nameref{ArchitecturalDesign:datatier}. The Ride Allocator has only one role, to assign and to handle the ride, both future and zerotime. The system controller is the \textquotedblleft heart\textquotedblright of the provider: it involves the ride allocator when is needed, it gives all the services of the system, it provides the DBMS with the data to be stored (or asks him some data to be found) and communicates with the Client and Users Handler. The Client and User Handler, as its name said, handles the communications with the clients and administrates the Users, so which services can be shown and selected by them.\\
\\
The third tier is a presentation level. In the Service-Oriented pattern this level represents the available services. Here, the clients can see the services and select the desired one.\\
Finally, at the top of the image, there is a representation of the two kind of clients, the \gls{ws} and the \gls{ma}.\\
\\
All the tiers are also distinguished into the three parts of MVC-paradigm. The \nameref{ArchitecturalDesign:datatier} is the model\footnote{see the Alloy section or the UML class diagram into the RASD to see it. However, in section \ref{ArchitecturalDesign:datatier} it is studied again.}. The provider is also the controller: even if the controller can be seen as the component that manages the interaction between the view and the model, in this application we consider other \textquotedblleft handler\textquotedblright as part of controller because they encapsulate rules and action codes. The view is the union between the presentation tier (here the services are only shown to client, the \textquotedblleft decisions\textquotedblright are taken by the provider) and the clients.\\
\\
Up to now, we have introduced all the main components or tier of our system, without focusing on the communications between them, so we'll dedicate a little part of this paragraph on this argument.\\
All the communications between the model and the provider are managed by the DBMS that has store policies and finds the required data. The system controller is the central node in communication because it is the only way to all the other components of the provider.
The Client and User Handler is the link between the provider and the clients. It checks the type of the current user and, as consequence, the available services that he can uses. When a user asks a service, he binds the request asking for the related function to the System Controller. Finally, it checks the type of client, because they have two ways of communication. When a user is connected with the WS, the Client and User Handler load the pages into itself and then, using the HTTPS protocol sent them to the client. Besides, the communications with the \gls{ma} is implemented using sockets. The implementation of these ways of communication with the clients is realized by a common interface (see the section \ref{ArchitecturalDesign:comp_interfaces} for further information).

\section{Component view}
\label{ArchitecturalDesign:component}


\subsection{Data tier}
\label{ArchitecturalDesign:datatier}

This paragraph shows the Logical schema of the database in figure num for the application.\\
The underlined attributes are the primary keys of the tuples, while the
bold attributes are the reference keys.\\
\begin{itemize}
	\item rides (\underline{rideID}, \textbf{passenger}, \textbf{driver}, \textbf{departure}, \textbf{destination}, departureTime, arrivalTime, creationDate, isFuture) : \\
	it contains both the zerotime rides and future rides, the field isFuture has value 1 when it's a future ride, 0 when zerotime ride.
	
	\item users (\underline{userID}, email, password, name, surname, taxcode, birthday, cityOfResidence, isDriver, registrationDate, activationCode, activated) : \\
	it contains the general and fundamental information of all the users. The field isDriver has value 1 when the user is a driver, 0 otherwise. The field activated has value 1 if the user has completed the registration process by confirming on the link with his activation code sent to his e-mail address, 0 otherwise.
	
	\item drivers (\underline{driverID}, \textbf{userProfile} ,cabCarCode, \textbf{cabCompany}) : \\
	it contains all the information of the drivers. The field userProfile is the reference key to the record in the users table which contains all the other general information of the driver.
	
	\item cabCompanies (\underline{cabCompanyID}, name) : \\
	it contains all the cab companies that use myTaxyService.
	
	\item positions (\underline{positionID}, gpsCoordinates, \textbf{address}, civicNumber) : \\
	it contains the stored positions for the rides (departure and destination) with the reference to the corresponding address in the table addresses and optionally the gps coordinates and the civic number.
	
	\item addresses (\underline{addressID}, city, street, \underline{area}) : \\
	it contains all the existing streets and cities covered by myTaxyService, with the reference to the area which they belong to.
	
	\item areas (\underline{areaID}, name) : \\
	it contains all the areas covered by myTaxyService.
	
	\item driversWaiting (\underline{\textbf{area, driver}}, driverAddedTime) : \\
	it contains all the available drivers waiting for a ride request. The tuple "area,driver" is unique because a driver cannot be available in more than one area at time. The field driverAddedTime contains the date and time when the driver is added to the list of available drivers for a certain area, it is useful to sort the list with the desired order (a FIFO queue in our application).
	
	\item workShifts (\underline{workShiftID}, \textbf{driver}, weekDayNumber, startingTime, endingTime) : \\
	it contains all the work shifts of a driver. weekDayNumber is the number of the day of the week (between 1 and 7, 1 is Monday, 7 Sunday). startingTime and endingTime represent a continuous time range of a work shift of a driver in a certain day of the week.
	
	\item alerts (\underline{alertID}, \textbf{user}, receptionDate, message) : \\
	it contains all the alerts that a user has received. "user" field is the reference to the receiver of the alert.
	
\end{itemize}

\begin{figure}[h]
	\centering
	\includegraphics[width=0.75\paperheight, angle=90] {DataTier}
	\caption{Logical schema of the database}
	\label{ArchitecturalDesign:datatier_figure}
\end{figure}

\clearpage

\subsection{Presentation tier}
\label{ArchitecturalDesign:services}

The available services are grouped into four main section:\\
\begin{itemize}
	\item \textit{Login and Registration.} This service is always available at the first access to myTaxiService, both for the \gls{ma} and the \gls{ws}. The user (it is not important which kind of user he want to become) has to log into the service or to register himself the first time. When the visitor clicks on login \footnote{see \autoref{UIdesign} for further information)}, he inserts his personal keys, then the Client and User Handler verifies the correctness of those keys, then checks the type of user to shows his services. (If the user is a driver or a cab company administrator other special credentials will be asked to increase security).\\
	
	\item \textit{Ride services.} This macro section contains all the functionalities related to the rides, so the characteristic ones of myTaxiService. The zerotime and future rides' reservation, the possibility to view or to modify the personal rides and the reading of user's alerts belong to this area and they are all shown together.\\
	The Client and User Handler shows these services to all logged users (except for the administrators).\\
	
	\item \textit{Driver services.} Driver services is a section reserved to the drivers logged into the \gls{ma}, for the reason presented in \autoref{ArchitecturalDesign:preamble}. The functionalities give here are the management of work shifts, the notifications of availability and the reading of reserved alerts (for instance, the request for a ride or the confirmation of a ride).\\
	
	\item \textit{Administration services.} This section, for security reasons, can be accessed only with administrator credentials (they consists in a couple name and password and in the use of an electronic card) into the company's headquarters on the \gls{ws} version. The Client and User Handler shows into this section the following functionalities: create or remove a driver profile, notification for all the users (usually, for general information or problems with the service) and checks some service information (for instance anomaly values of taxi queues).
\end{itemize}


\section{Deployment view}
\label{ArchitecturalDesign:deploy}

cosa scrivere qui? c'Ã¨ un diagramma che mostra i vari componenti software/hardware\\
e quindi dobbiamo fare un diagramma contenente le classi principali del controller

\section{Runtime view}
\label{ArchitecturalDesign:runtime}

In this paragraph we'll show the main features on the runtime view, which means the UX diagrams and the sequence diagrams.\\
The UX diagrams display the structure of the myTaxiService's screens (input forms, available functions and shown data) and the effects of each function (the next screens viewed). The sequence diagrams show the sequence of functions's calling and screens to benefit of a functionality.\\
\\
An important note is the following: the functionality Read The Alerts\footnote{see the RASD for further information.} is not shown here. It is performed as a simple screen on the Homepage that redirect to another screen with only the list of alerts (composed by a title and a written text).\\
\\
Finally, the two version of myTaxiService (\gls{ws} and \gls{ma}) have no differences on the visualization of the screen. In fact, the screen has the same name and the same purpose, but they are adapted to the particular version where they are displayed.\\

\clearpage

\subsection{UX Diagram}
\label{ArchitecturalDesign:UX}

\subsubsection{Starting Page}
\label{ArchitecturalDesign:UX_StartingPage}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:firstUX}
	\centering
	\includegraphics[width = \textwidth] {runtime/UX_StartingPage}
	\caption[UX Diagram from the Starting Page.] {The UX diagram from the Starting Page. The main functionalities available from this screen are displayed here.}
\end{figure}

\clearpage

\subsubsection{Profile Management}
\label{ArchitecturalDesign:UX_Homepage}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:secondUX}
	\centering
	\includegraphics[width = \textwidth] {runtime/UX_ProfileManagement}
	\caption[UX Diagram for Profile Management.] {The UX diagram for the management of the personal profile. All the possible operations are displayed here.}
\end{figure}

\clearpage

\subsubsection{Zerotime and Future Rides}
\label{ArchitecturalDesign:UX_Ride}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:fourthUX}
	\centering
	\includegraphics[width = \textwidth] {runtime/UX_Ride}
	\caption[UX Diagram for the Ride booking.] {The UX diagram for both the booking of a future ride and the asking for a zerotime ride, starting from the homepage.\\
		In order to make the diagram easy to understand, not all the error screens are inserted into the diagram: only the first one is shown.The other ones are similar and where there is an input form.}
\end{figure}

\clearpage

\subsubsection{Check The Reservations}
\label{ArchitecturalDesign:UX_CheckReservations}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:thirdUX}
	\centering
	\includegraphics[width = \textwidth] {runtime/UX_CheckReservation}
	\caption[UX Diagram for Check the Reservations.] {The UX diagram for the management of the personal reservations.}
\end{figure}

%\clearpage

\subsubsection{Driver Functionalities}
\label{ArchitecturalDesign:UX_Driver}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:fifthUX}
	\centering
	\includegraphics[width = \textwidth] {runtime/UX_Driver}
	\caption[UX Diagram for the Driver functionalities.] {The Ux diagram for the Driver functionalities.}
\end{figure}

\clearpage

\subsection{Sequence Diagram}
\label{ArchitecturalDesign:SD}

In this section are displayed the sequence diagram of myTaxiService run-view. In each diagram where the actor is an user and not a visitor of the website there is always an edge with \textquotedblleft Login Procedure\textquotedblright that can be misunderstood: the login to the websites it is required to perform the desired action, but if it is already done (for instance when the user is on his homepage after another operation) the login it is not requested again.\\

\subsubsection{Registration}
\label{ArchitecturalDesign:SD_Registration}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:firstSD}
	\centering
	\includegraphics[width = \textwidth] {runtime/SD_Registration}
	\caption[Sequence Diagram for the Registration.] {The sequence diagram for the Registration.}
\end{figure}

\clearpage

\subsubsection{Login}
\label{ArchitecturalDesign:SD_Login}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:secondSD}
	\centering
	\includegraphics[width = 0.75\textwidth] {runtime/SD_Login}
	\caption[Sequence Diagram for the login.] {The sequence diagram for the Login.}
\end{figure}

%\clearpage

\subsubsection{Profile Management}
\label{ArchitecturalDesign:SD_ProfileManagement}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:thirdSD}
	\centering
	\includegraphics[width = 0.85\textwidth] {runtime/SD_ProfileManagement}
	\caption[Sequence Diagram for the Profile Management.] {The sequence diagram for the management of the personal profile.\\
		 The only data that can be modified are the email and the password used to log into the system, while name, surname, tax code, gender and birthday are not modifiable by definition.}
\end{figure}

\clearpage

\subsubsection{Start Waiting Time}
\label{ArchitecturalDesign:SD_StartWaitingTime}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:fourthSD}
	\centering
	\includegraphics[width = \textwidth] {runtime/SD_StartWaitingTime}
	\caption[Sequence Diagram for Start Waiting Time.] {The sequence diagram for the notification of waiting time's start.}
\end{figure}

\clearpage

\subsubsection{Workshifts Management}
\label{ArchitecturalDesign:SD_WorkshiftsManagement}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:fifthSD}
	\centering
	\includegraphics[width = \textwidth] {runtime/SD_WorkshiftsManagement}
	\caption[Sequence Diagram for the Workshifts Management.] {The sequence diagram for the management of the driver's workshifts.}
\end{figure}

%\clearpage

\subsubsection{Check The Reservations}
\label{ArchitecturalDesign:SD_CheckReservation}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:sixthSD}
	\centering
	\includegraphics[width = 0.9\textwidth] {runtime/SD_CheckTheReservations}
	\caption[Sequence Diagram for Check the Reservations.] {The sequence diagram for the management of personal booking.}
\end{figure}

\clearpage

\subsubsection{Zerotime Ride}
\label{ArchitecturalDesign:SD_Zerotime}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:seventhSD}
	\centering
	\includegraphics[width = \textwidth] {runtime/SD_ZerotimeRide}
	\caption[Sequence Diagram for the Zerotime Ride.] {The sequence diagram for the asking for a zerotime ride.\\
		In order to make the diagram easy to understand, the errors on inserting the positions are not modelled.}
\end{figure}

\clearpage

\subsubsection{Future Ride Booking}
\label{ArchitecturalDesign:SD_Zerotime}

\begin{figure}[hb!]
	\label{ArchitecturalDesign:seventhSD}
	\centering
	\includegraphics[width = \textwidth] {runtime/SD_FutureRideBooking}
	\caption[Sequence Diagram for the Future Ride.] {The sequence diagram for the booking of a future ride.\\
		In order to make the diagram easy to understand, the errors on inserting either the positions or the departure are not modelled.}
\end{figure}

%\clearpage

\section{Component Interfaces}
\label{ArchitecturalDesign:comp_interfaces}

TESTO NON UFFICIALE\\
descrizione di tutte le interfacce tra i vari component e verso l'esterno.\\
Forse si metteranno anche i principali metodi?\\


\section{Selected architectural styles and patterns}
\label{ArchitecturalDesign:design_patterns}


EVENTBASED per ora\\


%End of chapter
\end{document}